{% extends "base.html" %}
{% block title %}Comprobantes{% endblock %}
{% block content %}
<div class="container mt-5 mb-5">
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-header bg-primary text-white rounded-top-4 py-3">
      <h4 class="mb-0"><i class="bi bi-receipt-cutoff me-2"></i>Generación de Comprobantes</h4>
    </div>

    <div class="card-body p-4">

      <!-- Mensajes flash -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <!-- Formulario principal -->
      <form method="POST" class="mb-5">
        <div class="row g-4 align-items-end">
          <div class="col-lg-5 col-md-6">
            <label for="empleado" class="form-label fw-semibold fs-6">Seleccionar Empleado</label>
            <select name="empleado" id="empleado" class="form-select form-select-lg shadow-sm">
              <option value="">-- Seleccionar --</option>
              {% for e in empleados %}
              <option value="{{ e[0] }}" {% if e[2] == 0 %}disabled{% endif %}>
                {{ e[1] }} {% if e[2] == 0 %}(sin nómina){% endif %}
              </option>
              {% endfor %}
            </select>
          </div>

          <div class="col-lg-7 col-md-6 text-md-end text-center">
            <button type="submit" name="accion" value="individual" 
                    class="btn btn-success btn-lg shadow-sm px-4 me-3 mb-2">
              <i class="bi bi-file-earmark-pdf-fill me-1"></i> Generar Individual
            </button>
            <button type="submit" name="accion" value="masiva" 
                    class="btn btn-warning btn-lg shadow-sm px-4 me-3 mb-2">
              <i class="bi bi-archive-fill me-1"></i> Generar Masiva
            </button>
            <button type="submit" name="accion" value="historial" 
                    class="btn btn-secondary btn-lg shadow-sm px-4 mb-2">
              <i class="bi bi-clock-history me-1"></i> Ver Historial
            </button>
          </div>
        </div>
      </form>

      <!-- Historial de comprobantes -->
      {% if comprobantes %}
      <div class="table-responsive mt-4">
        <table class="table table-hover align-middle shadow-sm">
          <thead class="table-primary text-center">
            <tr>
              <th>ID</th>
              <th>Empleado</th>
              <th>Fecha de Emisión</th>
              <th>Firma Digital</th>
            </tr>
          </thead>
          <tbody>
            {% for c in comprobantes %}
            <tr>
              <td class="text-center">{{ c[0] }}</td>
              <td>{{ c[1] }}</td>
              <td class="text-center">{{ c[2].strftime('%Y-%m-%d %H:%M') if c[2] else '' }}</td>
              <td><code>{{ c[3] }}</code></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<!--  Estilos adicionales -->
<style>
  .card {
    border-radius: 1rem !important;
  }
  .card-header {
    background: linear-gradient(135deg, var(--bs-primary), #4a7dfc);
  }
  .form-select-lg {
    height: calc(3.2rem + 2px);
    font-size: 1.1rem;
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
  }
  .btn-lg {
    font-size: 1.05rem;
    border-radius: 0.75rem;
  }
  .btn i {
    font-size: 1.2rem;
    vertical-align: middle;
  }
  .btn:hover {
    transform: scale(1.03);
    transition: 0.2s ease;
  }
  table thead th {
    background-color: var(--bs-primary) !important;
    color: white;
  }
  code {
    background-color: #f8f9fa;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.9rem;
  }
</style>
{% endblock %}